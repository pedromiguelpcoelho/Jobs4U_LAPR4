# US 1017 - As Customer Manager, I want to upload a text file with the candidate responses for an interview. (#39)

## 1. Context
### 1.1. Customer Specifications and Clarifications

* Question 214: US1017/1018 – O nosso grupo tem uma dúvida em relação ao processamento dos ficheiros de respostas dos 
  candidatos para a entrevista. No caso de upload de um ficheiro, se a pergunta que requer um número como resposta for 
  preenchida com um formato inválido, por exemplo, uma letra, devemos considerar isso como um formato inválido na 
  US 1017 (e pedir para o user voltar a dar upload a um ficheiro válido) ou devemos, na US1018, considerar que está 
  incorreta e atribuir 0 pontos automaticamente para essa resposta inválida? Isto é, na US 1017, devemos apenas verificar 
  o formato do ficheiro ou devemos verificar também se as respostas são preenchidas com o tipo de dados correto?
  * Answer 214: O caso mencionado deve ser considerado um erro de validação do ficheiro (ou seja, o ficheiro submetido não 
    corresponde à gramática definida).

* Question 227: Em termos de "upload" certamente passa pela verificação com a gramática e após sucesso colocar o ficheiro das 
  respostas da entrevista junto da pasta com os ficheiros da "Application" certo?
  * Answer 227: Sim, a sintaxe deve ser verificada e, se tudo estiver correto, o ficheiro deve ser “importado” para o sistema 
    de forma a que possa ser usado posteriormente, por exemplo, no âmbito da US 1018. Qual a solução para o “importar” faz 
    parte da vossa solução. Idealmente julgo que faria sentido que ficasse integrado na base de dados. Não sendo possível, 
    penso que é aceitável que fique numa pasta/diretório de um servidor.

## 1.2. Explanation

The goal of this user story is to enable Customer Managers to upload a text file that contains the responses of a candidate 
for a job interview. This data will be utilized to verify if candidates meet the specific requirements for a job opening. 
By uploading the text file, the system will automatically parse and validate the candidate information against the predefined 
job criteria.

## 2. Requirements

**US 1017** - As Customer Manager, I want to upload a text file with the candidate responses for an interview.

#### Use Cases:

* This user story will encompass use cases 1017 according to the data present in the Specifications Document.
  ([Specifications_Document_v2.md](..%2F..%2FGeneralDocumentation%2FUse%20Case%20Diagram%2FSpecifications_Document_v2.md)).

#### Functionality:

* This task enables Customer Managers to upload a text file that contains the responses of a candidate for a job interview. 
  The system provides an interface for Customer Managers to upload the file, which is then parsed to extract candidate information. 
  The extracted data is automatically compared against predefined job interview answers.

#### Understanding:

* The Customer Manager is responsible for uploading the text file with candidate data, which the system will then parse 
  and validate. This process ensures that all candidate information is correctly captured and verified against the job
  interview answers.

#### Dependencies:

1. **US 1012 - As Customer Manager, I want to generate and export a template text file to help collect the candidate 
    answers during the interviews.**

US 1012 generates a template text file that outlines the questions the candidates need to answer during their interviews. 
  This template, which initially does not contain any responses, is used by candidates to fill in their information. In 
  US 1017, the Customer Manager uploads this now completed text file, which was previously generated by US 1012 and filled 
  out by the candidate, for verification purposes.

2. **US 1002 - As Customer Manager, I want to register a job opening.**

US 1002 allows Customer Managers to register job openings, which are then used to define the requirements for candidates. 
  The requirements are used to evaluate candidate applications, which are uploaded by Customer Managers in US 1017.

3. **US 2002 - As Operator, I want to register an application of a candidate for a job opening and import all files received.**

US 2002 enables Operators to register candidate applications for job openings. These applications will be listed so that 
  the completed file can later be associated with the corresponding application.

4. **US 1005 - As Customer Manager, I want to list all applications for a job opening.**

US 1005 allows the Customer Manager to list all applications for a specific job opening. This is crucial for US 2004, as 
  it enables the operator to select the correct application for verification.

#### Acceptance Criteria:

AC 1017.1: The system should validate the syntax of the uploaded text file against the predefined template structure. If 
  the syntax is incorrect, the system should reject the file and provide a clear error message indicating the specific issues, 
  ensuring that the customer manager can correct and re-upload the file.

AC 1017.2: The system should ensure that each uploaded text file is associated with a specific job application. The file 
  must be linked to the candidate’s application for a particular job opening.

AC 1017.3: Upon successful validation of the uploaded text file, the system should create a folder named with the identifier
  of the corresponding job application. The system must then move the validated file into this newly created folder. This 
  ensures proper organization and association of candidate requirements with the relevant job applications. If the file 
  validation fails, the system should not create the folder or move the file, providing feedback to the customer manager to resolve 
  any issues before proceeding.

AC 1017.4: The system should only list the Job Openings that are in the interviews phase, as it is during this phase that
the candidates will be evaluated by comparing their answers to the predefined ones.

#### Input and Output Data

*Input Data:*

* Selection Data :
  * Job Opening
  * Job Application
* Insert Data:
  * The file path

*Output Data:*
* Confirmation message about the Syntax Validation
* (In)Success message of the operation

## 3. Analysis

* UC 1017: Our domain model satisfies the requirements of the aforementioned use case, ensuring that Customer Managers
  can effectively upload a text file. For that we are interacting with the JobApplication Aggregate, by adding a file to
  the list of files of the JobApplication.
* See the domain model in: [domain_model_v10.puml](..%2F..%2FGeneralDocumentation%2FDomain%20Model%2Fdomain_model_v10.puml)

## 4. Design

### 4.1. Realization (Sequence Diagram)

For this user story, I decided to create two sequence diagrams that represent the interaction between the Customer Manager and the 
system. The first diagram represents the interaction of the UI with the InterviewModel_EX1 when the method isFileSyntaxCorrect(filePath)
returns true. The second diagram represents the interaction of the UI with the RequirementSpecificationModel_Ex1 when the 
method isFileSyntaxCorrect(filePath) returns false. This way, we can clearly visualize what happens when the file is valid 
and when the file is invalid.

#### 4.1.1. Sequence Diagram 1 - File is valid

[Sequence_Diagram_US1017_True_Version.puml](Sequence_Diagram_US1017_True_Version.puml)

#### 4.1.2. Sequence Diagram 2 - File is invalid

[Sequence_Diagram_US1017_False_Version.puml](Sequence_Diagram_US1017_False_Version.puml)

### 4.2. Class Diagram

For UC 2004, the decision to omit a separate class diagram from the documentation is based on the principles of Domain-Driven
Design (DDD). Duplicating class information from the domain model would introduce redundancy. By directly utilizing the domain
model, clarity and efficiency are maintained in the documentation process while ensuring alignment with the project's evolving
domain understanding. Therefore, to see how the Class Diagram for this User Story would look, you simply need to look at the
Domain Model and see the Job Application Aggregate and its specially with the FileJobApp (This is where the files we will
upload will be stored) and the JobOpening (We are uploading an interviews answers file, for an application in a specific Job Opening).

### 4.3. Applied Patterns

* **Service Layer:** The Service Layer pattern is applied to the `FileService`class. This class handle the business logic
  related to file operations. This pattern encapsulates business logic and transactions, providing a simplified interface to
  the client and promoting loose coupling between the presentation and data access layers.

* **Factory Pattern:** The Factory Pattern is applied implicitly within the repository and service initialization, where
  instances of repositories are created using specific factory methods or configuration settings. This pattern helps in creating
  objects without exposing the instantiation logic to the client and allows referring to the newly created object using a common
  interface.

* **SOLID Principles:** Some of the SOLID principles are applied throughout the design of the classes, ensuring that they
  are well-structured and maintainable.
  * **Single Responsibility Principle (SRP):** Each class has a single responsibility. For example, `FileService` handles
    file-related operations.
  * **Open-Closed Principle (OCP):** Classes are open for extension but closed for modification. For instance, new methods
    can be added to `FileService` without altering existing ones, allowing the system to evolve without breaking existing
    functionality.

### 4.4. Tests

Unit tests were deemed unnecessary as domain concepts had been thoroughly tested. Current operations involve manipulation
of existing domain instances, minimizing the need for additional testing.

## 5. Implementation

### Main classes created

* `UploadInterviewModelFileUI`: Responsible for the user interface for the candidate requirements file upload functionality.
  Manages the main file upload flow, including job opening and application selection, file syntax verification, and moving the
  file to the appropriate directory.

* `FileService`: Responsible for services related to files, such as creating directories and moving files. It has several
  functions including creating a directory for the job opening if it does not exist, moving the file to the job opening directory,
  creating a directory for the job application within the job opening directory if it does not exist, and moving the file to
  the job application directory within the job opening directory.

* `UploadFileController`: Coordinates the business logic related to the upload of candidate requirements files. It has several
  functions including retrieving all job openings from the repository and returning a list, retrieving a job opening by its
  index in the list of all job openings, retrieving all applications for a given job opening from the repository and returning
  a list, retrieving an application by its index in the list of all applications for a given job opening, and creating a new
  FileJobApp with the provided path, saving it to the database, and associating it with the given application.

## 6. Integration/Demonstration

To execute this functionality, we need to run the script `build-all`, `run-bootstrap` (to load the actors responsible for
uploading the file), and finally `run-backoffice` to execute the user interface. Next, we should log in with the credentials of
a customer manager, for example, manager1@this.app (Username) and managerA1 (Password), and choose the "Settings" option, then select the
twelfth option (Upload Interview Model File). Finally, we just have to select the job opening (From a list of only JO that are in 
the Interviews Phase) and the job application from the lists that will be displayed and enter the file path. If the file is 
syntactically correct, a success message will be displayed, and the file will be moved to the appropriate directory. If the file 
is not syntactically correct, an error message will be displayed (specifying what went wrong), and the file will not be moved.

## 7. Observations 

N/A